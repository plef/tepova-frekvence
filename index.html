<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mƒõ≈ôen√≠ tepov√© frekvence zdarma - Online mƒõ≈ôiƒç tepu BPM | Heart Rate Counter</title>
    <meta name="description" content="Zmƒõ≈ôte si tepovou frekvenci online zdarma klik√°n√≠m v rytmu srdce. ≈Ω√°dn√© za≈ô√≠zen√≠ nen√≠ pot≈ôeba. Funguje na v≈°ech za≈ô√≠zen√≠ch. Free heart rate counter - measure your pulse instantly by tapping.">
    <meta name="keywords" content="tepov√° frekvence, mƒõ≈ôen√≠ tepu, srdeƒçn√≠ tep, BPM, puls, heart rate, pulse counter, fitness, zdrav√≠, zdarma, free heart rate monitor">

    <!-- Open Graph pro Facebook/LinkedIn -->
    <meta property="og:title" content="Mƒõ≈ôen√≠ tepov√© frekvence zdarma | Free Heart Rate Counter">
    <meta property="og:description" content="Zmƒõ≈ôte si tepovou frekvenci online klik√°n√≠m v rytmu srdce. ≈Ω√°dn√© za≈ô√≠zen√≠ nen√≠ pot≈ôeba. Measure your heart rate instantly by tapping.">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="cs_CZ">
    <meta property="og:locale:alternate" content="en_US">
    <meta property="og:locale:alternate" content="de_DE">
    <meta property="og:locale:alternate" content="es_ES">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Mƒõ≈ôen√≠ tepov√© frekvence zdarma | Free Heart Rate Counter">
    <meta name="twitter:description" content="Zmƒõ≈ôte si tepovou frekvenci online klik√°n√≠m. Measure your heart rate by tapping.">

    <!-- Dal≈°√≠ SEO -->
    <meta name="robots" content="index, follow">
    <meta name="language" content="Czech">
    <meta name="author" content="Heart Rate Counter App">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .heartbeat {
            animation: heartbeat 0.6s ease-in-out infinite;
        }
    </style>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getDatabase, ref, runTransaction, onValue } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCjPQLIB2XQ6gEm7mlMRy2VtIuDg1PX4pc",
            authDomain: "tepova-frekvence.firebaseapp.com",
            projectId: "tepova-frekvence",
            storageBucket: "tepova-frekvence.firebasestorage.app",
            messagingSenderId: "41170643261",
            appId: "1:41170643261:web:fad063adde9513ccec7d54",
            databaseURL: "https://tepova-frekvence-default-rtdb.europe-west1.firebasedatabase.app"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Expose to global scope
        window.firebaseDB = database;
        window.firebaseRef = ref;
        window.firebaseTransaction = runTransaction;
        window.firebaseOnValue = onValue;
    </script>
</head>
<body>
    <div id="app"></div>

    <script>
        let clicks = [];
        let bpm = null;
        let isActive = false;
        let currentLang = 'cs';
        let visitCount = 0;
        let measurementCount = 0;
        let userCountry = 'unknown';
        let sessionMeasurements = [];
        const MAX_MEASUREMENTS_PER_SESSION = 5;
        const MAX_TOTAL_MEASUREMENTS = 10000000; // ~1 GB limit
        let isIOS = false;

        // Detekce iOS za≈ô√≠zen√≠
        function detectIOS() {
            const userAgent = navigator.userAgent.toLowerCase();
            isIOS = /iphone|ipad|ipod/.test(userAgent) && !window.MSStream;
            return isIOS;
        }

        // Ulo≈æit BPM do Apple Health p≈ôes Shortcuts
        function saveToAppleHealth(bpmValue) {
            if (!isIOS) return;

            // URL scheme pro iOS Shortcuts
            // Format: shortcuts://run-shortcut?name=SaveHeartRate&input=text:75
            const shortcutURL = `shortcuts://run-shortcut?name=SaveHeartRate&input=text:${bpmValue}`;
            window.location.href = shortcutURL;
        }

        // Detekce zemƒõ u≈æivatele
        async function detectUserCountry() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                userCountry = data.country_code || 'unknown';
                console.log('Country detected:', userCountry);
            } catch (error) {
                console.error('Failed to detect country:', error);
                userCountry = 'unknown';
            }
        }

        // Naƒç√≠st mƒõ≈ôen√≠ z aktu√°ln√≠ session
        function loadSessionMeasurements() {
            const stored = localStorage.getItem('sessionMeasurements');
            const lastSessionTime = localStorage.getItem('lastSessionTimestamp');
            const now = Date.now();
            const SESSION_DURATION = 30 * 60 * 1000;

            // Reset pokud je to nov√° session
            if (!lastSessionTime || (now - parseInt(lastSessionTime)) > SESSION_DURATION) {
                sessionMeasurements = [];
                localStorage.setItem('sessionMeasurements', JSON.stringify([]));
            } else if (stored) {
                sessionMeasurements = JSON.parse(stored);
            }
        }

        // Firebase session-based poƒç√≠tadlo n√°v≈°tƒõv
        async function initFirebaseCounters() {
            try {
                const now = Date.now();
                const lastSessionTime = localStorage.getItem('lastSessionTimestamp');
                const SESSION_DURATION = 30 * 60 * 1000; // 30 minut

                // Zkontroluj, jestli je to nov√° session
                const isNewSession = !lastSessionTime || (now - parseInt(lastSessionTime)) > SESSION_DURATION;

                const visitsRef = window.firebaseRef(window.firebaseDB, 'counters/visits');

                // Increment jen p≈ôi nov√© session
                if (isNewSession) {
                    await window.firebaseTransaction(visitsRef, (current) => {
                        return (current || 0) + 1;
                    });
                    // Ulo≈æ timestamp t√©to session
                    localStorage.setItem('lastSessionTimestamp', now.toString());
                }

                // Listen for real-time updates
                window.firebaseOnValue(visitsRef, (snapshot) => {
                    visitCount = snapshot.val() || 0;
                    render();
                });

                // Listen for measurements counter
                const measurementsRef = window.firebaseRef(window.firebaseDB, 'counters/measurements');
                window.firebaseOnValue(measurementsRef, (snapshot) => {
                    measurementCount = snapshot.val() || 0;
                    render();
                });
            } catch (error) {
                console.error('Firebase error:', error);
                // Fallback to localStorage
                visitCount = parseInt(localStorage.getItem('sessionCount') || '0');
                if (!localStorage.getItem('lastSessionTimestamp')) {
                    visitCount++;
                    localStorage.setItem('sessionCount', visitCount);
                    localStorage.setItem('lastSessionTimestamp', Date.now().toString());
                }
            }
        }

        // Ulo≈æit mƒõ≈ôen√≠ do Firebase
        async function saveMeasurement(bpmValue) {
            try {
                // Kontrola session limitu
                if (sessionMeasurements.length >= MAX_MEASUREMENTS_PER_SESSION) {
                    console.warn('Session measurement limit reached');
                    return false;
                }

                // Kontrola celkov√©ho limitu
                if (measurementCount >= MAX_TOTAL_MEASUREMENTS) {
                    console.warn('Total measurement limit reached (1 GB)');
                    return false;
                }

                const timestamp = Date.now();
                const oneYearAgo = timestamp - (365 * 24 * 60 * 60 * 1000);

                // Pokud je timestamp star≈°√≠ ne≈æ rok, neukladat (retence 1 rok)
                if (timestamp < oneYearAgo) {
                    return false;
                }

                // Ulo≈æit detail mƒõ≈ôen√≠
                const measurementRef = window.firebaseRef(window.firebaseDB, `measurements/${timestamp}`);
                await window.firebaseTransaction(measurementRef, () => {
                    return {
                        bpm: bpmValue,
                        country: userCountry,
                        timestamp: timestamp
                    };
                });

                // Increment celkov√Ω counter mƒõ≈ôen√≠
                const measurementsRef = window.firebaseRef(window.firebaseDB, 'counters/measurements');
                await window.firebaseTransaction(measurementsRef, (current) => {
                    return (current || 0) + 1;
                });

                // Increment counter per country
                const countryMeasurementsRef = window.firebaseRef(window.firebaseDB, `counters/measurementsByCountry/${userCountry}`);
                await window.firebaseTransaction(countryMeasurementsRef, (current) => {
                    return (current || 0) + 1;
                });

                // P≈ôidat BPM k celkov√© sumƒõ per country
                const countryBpmRef = window.firebaseRef(window.firebaseDB, `counters/totalBpmByCountry/${userCountry}`);
                await window.firebaseTransaction(countryBpmRef, (current) => {
                    return (current || 0) + bpmValue;
                });

                // P≈ôidat do session measurements
                sessionMeasurements.push(timestamp);
                localStorage.setItem('sessionMeasurements', JSON.stringify(sessionMeasurements));

                return true;
            } catch (error) {
                console.error('Failed to save measurement:', error);
                return false;
            }
        }

        const translations = {
            cs: {
                title: 'Mƒõ≈ôen√≠ tepov√© frekvence',
                subtitle: 'Klikejte v rytmu sv√©ho tepu',
                bpmUnit: 'tep≈Ø za minutu',
                category: {
                    resting: 'Klidov√Ω',
                    normal: 'Norm√°ln√≠',
                    elevated: 'Zv√Ω≈°en√Ω',
                    high: 'Vysok√Ω'
                },
                clickCount: 'Poƒçet kliknut√≠:',
                hint: 'Pro p≈ôesnƒõj≈°√≠ mƒõ≈ôen√≠ klikejte alespo≈à 5-10x',
                startMessage: 'Zaƒçnƒõte klikat...',
                clicksMessage: 'kliknut√≠...',
                reset: 'Resetovat',
                howToTitle: 'Jak mƒõ≈ôit:',
                howTo: [
                    'Najdƒõte si tep na krku nebo z√°pƒõst√≠',
                    'Klikejte na ka≈æd√Ω √∫der srdce',
                    'Pokraƒçujte alespo≈à 5-10 √∫der≈Ø',
                    'Aplikace vypoƒç√≠t√° v√°≈° puls'
                ],
                sessionCount: 'N√°v≈°tƒõv:',
                measurementCount: 'Mƒõ≈ôen√≠:',
                privacyStatement: 'Ukl√°d√°me: BPM, zemi, ƒças mƒõ≈ôen√≠ ‚Ä¢ Neukl√°d√°me: IP adresy, jm√©na, osobn√≠ √∫daje',
                saveToHealth: 'Ulo≈æit do Health'
            },
            en: {
                title: 'Heart Rate Measurement',
                subtitle: 'Tap in rhythm with your heartbeat',
                bpmUnit: 'beats per minute',
                category: {
                    resting: 'Resting',
                    normal: 'Normal',
                    elevated: 'Elevated',
                    high: 'High'
                },
                clickCount: 'Tap count:',
                hint: 'For more accurate results, tap at least 5-10 times',
                startMessage: 'Start tapping...',
                clicksMessage: 'taps...',
                reset: 'Reset',
                howToTitle: 'How to measure:',
                howTo: [
                    'Find your pulse on neck or wrist',
                    'Tap on each heartbeat',
                    'Continue for at least 5-10 beats',
                    'App will calculate your heart rate'
                ],
                sessionCount: 'Visits:',
                measurementCount: 'Measurements:',
                privacyStatement: 'We store: BPM, country, timestamp ‚Ä¢ We don\'t store: IP addresses, names, personal data',
                saveToHealth: 'Save to Health'
            },
            de: {
                title: 'Herzfrequenzmessung',
                subtitle: 'Tippen Sie im Rhythmus Ihres Herzschlags',
                bpmUnit: 'Schl√§ge pro Minute',
                category: {
                    resting: 'Ruhepuls',
                    normal: 'Normal',
                    elevated: 'Erh√∂ht',
                    high: 'Hoch'
                },
                clickCount: 'Anzahl der Klicks:',
                hint: 'F√ºr genauere Ergebnisse mindestens 5-10 Mal tippen',
                startMessage: 'Beginnen Sie zu tippen...',
                clicksMessage: 'Klicks...',
                reset: 'Zur√ºcksetzen',
                howToTitle: 'So messen Sie:',
                howTo: [
                    'Finden Sie Ihren Puls am Hals oder Handgelenk',
                    'Tippen Sie bei jedem Herzschlag',
                    'Fahren Sie mindestens 5-10 Schl√§ge fort',
                    'Die App berechnet Ihre Herzfrequenz'
                ],
                sessionCount: 'Besuche:',
                measurementCount: 'Messungen:',
                privacyStatement: 'Wir speichern: BPM, Land, Zeitstempel ‚Ä¢ Wir speichern nicht: IP-Adressen, Namen, pers√∂nliche Daten',
                saveToHealth: 'In Health speichern'
            },
            es: {
                title: 'Medici√≥n de frecuencia card√≠aca',
                subtitle: 'Toca al ritmo de tu coraz√≥n',
                bpmUnit: 'latidos por minuto',
                category: {
                    resting: 'En reposo',
                    normal: 'Normal',
                    elevated: 'Elevado',
                    high: 'Alto'
                },
                clickCount: 'N√∫mero de toques:',
                hint: 'Para resultados m√°s precisos, toca al menos 5-10 veces',
                startMessage: 'Comienza a tocar...',
                clicksMessage: 'toques...',
                reset: 'Reiniciar',
                howToTitle: 'C√≥mo medir:',
                howTo: [
                    'Encuentra tu pulso en el cuello o mu√±eca',
                    'Toca en cada latido del coraz√≥n',
                    'Contin√∫a durante al menos 5-10 latidos',
                    'La app calcular√° tu frecuencia card√≠aca'
                ],
                sessionCount: 'Visitas:',
                measurementCount: 'Mediciones:',
                privacyStatement: 'Almacenamos: BPM, pa√≠s, marca de tiempo ‚Ä¢ No almacenamos: direcciones IP, nombres, datos personales',
                saveToHealth: 'Guardar en Salud'
            }
        };

        function handleClick() {
            const now = Date.now();
            clicks.push(now);
            isActive = true;
            calculateBPM();
            render();
        }

        function calculateBPM() {
            if (clicks.length < 2) return;

            const recentClicks = clicks.slice(-10);
            
            if (recentClicks.length >= 2) {
                const intervals = [];
                for (let i = 1; i < recentClicks.length; i++) {
                    intervals.push(recentClicks[i] - recentClicks[i - 1]);
                }
                
                const avgInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length;
                const calculatedBpm = Math.round(60000 / avgInterval);
                
                if (calculatedBpm >= 30 && calculatedBpm <= 220) {
                    bpm = calculatedBpm;
                }
            }
        }

        function reset() {
            // Ulo≈æit mƒõ≈ôen√≠ pokud je validn√≠
            if (bpm !== null && clicks.length >= 5) {
                saveMeasurement(bpm);
            }
            clicks = [];
            bpm = null;
            isActive = false;
            render();
        }

        function changeLang(lang) {
            currentLang = lang;
            render();
        }

        function getBpmCategory(bpm) {
            if (!bpm) return { text: '', color: '' };
            const t = translations[currentLang].category;
            if (bpm < 60) return { text: t.resting, color: 'text-blue-600' };
            if (bpm < 100) return { text: t.normal, color: 'text-green-600' };
            if (bpm < 140) return { text: t.elevated, color: 'text-orange-600' };
            return { text: t.high, color: 'text-red-600' };
        }

        function render() {
            const t = translations[currentLang];
            const category = getBpmCategory(bpm);
            
            document.getElementById('app').innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-red-50 to-pink-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
                        
                        <!-- Language Selector -->
                        <div class="flex justify-center gap-2 mb-6">
                            ${['cs', 'en', 'de', 'es'].map(lang => `
                                <button
                                    onclick="changeLang('${lang}')"
                                    class="px-3 py-1 rounded-lg text-sm font-medium transition-colors ${
                                        currentLang === lang 
                                            ? 'bg-red-500 text-white' 
                                            : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                    }"
                                >
                                    ${lang.toUpperCase()}
                                </button>
                            `).join('')}
                        </div>

                        <div class="text-center mb-8">
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">
                                ${t.title}
                            </h1>
                            <p class="text-gray-600">
                                ${t.subtitle}
                            </p>
                        </div>

                        <button
                            onclick="handleClick()"
                            class="w-full aspect-square rounded-full bg-gradient-to-br from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 active:scale-95 transition-all duration-200 shadow-lg flex items-center justify-center mb-8 cursor-pointer"
                        >
                            <svg class="w-24 h-24 text-white ${isActive ? 'heartbeat' : ''}" fill="white" stroke="white" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                            </svg>
                        </button>

                        <div class="text-center mb-6">
                            ${bpm ? `
                                <div class="text-6xl font-bold text-gray-800 mb-2">
                                    ${bpm}
                                </div>
                                <div class="text-xl text-gray-600 mb-1">
                                    ${t.bpmUnit}
                                </div>
                                <div class="text-lg font-semibold ${category.color}">
                                    ${category.text}
                                </div>
                            ` : `
                                <div class="text-gray-400 text-lg py-8">
                                    ${clicks.length === 0 ? t.startMessage : `${clicks.length} ${t.clicksMessage}`}
                                </div>
                            `}
                        </div>

                        <div class="bg-gray-50 rounded-xl p-4 mb-6">
                            <div class="text-sm text-gray-600 space-y-1">
                                <div class="flex justify-between">
                                    <span>${t.clickCount}</span>
                                    <span class="font-semibold">${clicks.length}</span>
                                </div>
                                ${clicks.length >= 2 ? `
                                    <div class="text-xs text-gray-500 mt-2">
                                        ${t.hint}
                                    </div>
                                ` : ''}
                            </div>
                        </div>

                        ${isIOS && bpm !== null ? `
                        <button
                            onclick="saveToAppleHealth(${bpm})"
                            class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center gap-2 cursor-pointer mb-3"
                        >
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                            </svg>
                            ${t.saveToHealth}
                        </button>
                        ` : ''}

                        <button
                            onclick="reset()"
                            class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center gap-2 cursor-pointer"
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                            ${t.reset}
                        </button>

                        <div class="mt-6 p-4 bg-blue-50 rounded-xl">
                            <h3 class="font-semibold text-blue-900 mb-2 text-sm">
                                ${t.howToTitle}
                            </h3>
                            <ol class="text-xs text-blue-800 space-y-1 list-decimal list-inside">
                                ${t.howTo.map(item => `<li>${item}</li>`).join('')}
                            </ol>
                        </div>

                        <!-- Glob√°ln√≠ statistiky -->
                        <div class="mt-6 p-2 text-center text-xs text-gray-400">
                            ${t.sessionCount} ${visitCount.toLocaleString()} ‚Ä¢ ${t.measurementCount} ${measurementCount.toLocaleString()}
                        </div>

                        <!-- Privacy -->
                        <div class="mt-2 p-2 text-center text-xs text-gray-300 italic">
                            üîí ${t.privacyStatement}
                        </div>
                    </div>
                </div>
            `;
        }

        // Initialize app
        detectIOS();
        render();
        loadSessionMeasurements();
        detectUserCountry();

        // Wait for Firebase to be ready, then initialize counters
        setTimeout(() => {
            if (window.firebaseDB) {
                initFirebaseCounters();
            }
        }, 100);
    </script>
</body>
</html>
