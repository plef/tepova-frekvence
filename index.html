<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mƒõ≈ôen√≠ tepov√© frekvence zdarma - Online mƒõ≈ôiƒç tepu BPM | Heart Rate Counter</title>
    <meta name="description" content="Zmƒõ≈ôte si tepovou frekvenci online zdarma klik√°n√≠m v rytmu srdce. ≈Ω√°dn√© za≈ô√≠zen√≠ nen√≠ pot≈ôeba. Funguje na v≈°ech za≈ô√≠zen√≠ch. Free heart rate counter - measure your pulse instantly by tapping.">
    <meta name="keywords" content="tepov√° frekvence, mƒõ≈ôen√≠ tepu, srdeƒçn√≠ tep, BPM, puls, heart rate, pulse counter, fitness, zdrav√≠, zdarma, free heart rate monitor">

    <!-- Open Graph pro Facebook/LinkedIn -->
    <meta property="og:title" content="Mƒõ≈ôen√≠ tepov√© frekvence zdarma | Free Heart Rate Counter">
    <meta property="og:description" content="Zmƒõ≈ôte si tepovou frekvenci online klik√°n√≠m v rytmu srdce. ≈Ω√°dn√© za≈ô√≠zen√≠ nen√≠ pot≈ôeba. Measure your heart rate instantly by tapping.">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="cs_CZ">
    <meta property="og:locale:alternate" content="en_US">
    <meta property="og:locale:alternate" content="de_DE">
    <meta property="og:locale:alternate" content="es_ES">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Mƒõ≈ôen√≠ tepov√© frekvence zdarma | Free Heart Rate Counter">
    <meta name="twitter:description" content="Zmƒõ≈ôte si tepovou frekvenci online klik√°n√≠m. Measure your heart rate by tapping.">

    <!-- Dal≈°√≠ SEO -->
    <meta name="robots" content="index, follow">
    <meta name="language" content="Czech">
    <meta name="author" content="Heart Rate Counter App">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg?v=3">
    <link rel="apple-touch-icon" href="favicon.svg?v=3">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .heartbeat {
            animation: heartbeat 0.6s ease-in-out infinite;
        }
    </style>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getDatabase, ref, runTransaction, onValue } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCjPQLIB2XQ6gEm7mlMRy2VtIuDg1PX4pc",
            authDomain: "tepova-frekvence.firebaseapp.com",
            projectId: "tepova-frekvence",
            storageBucket: "tepova-frekvence.firebasestorage.app",
            messagingSenderId: "41170643261",
            appId: "1:41170643261:web:fad063adde9513ccec7d54",
            databaseURL: "https://tepova-frekvence-default-rtdb.europe-west1.firebasedatabase.app"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Expose to global scope
        window.firebaseDB = database;
        window.firebaseRef = ref;
        window.firebaseTransaction = runTransaction;
        window.firebaseOnValue = onValue;
    </script>
</head>
<body>
    <div id="app"></div>

    <script>
        let clicks = [];
        let bpm = null;
        let isActive = false;
        let currentLang = 'cs';
        let visitCount = 0;
        let measurementCount = 0;
        let userCountry = 'unknown';
        let sessionMeasurements = [];
        const MAX_MEASUREMENTS_PER_SESSION = 5;
        const MAX_TOTAL_MEASUREMENTS = 10000000; // ~1 GB limit
        let isIOS = false;
        let showHealthSetup = false;
        let lastBpmForHealth = null;
        const SHORTCUT_ICLOUD_LINK = 'https://www.icloud.com/shortcuts/8d8c067e4a894472900d3dadf67c8364';

        // Country to language mapping
        const countryToLang = {
            // Czech speaking countries
            'CZ': 'cs',

            // English speaking countries
            'US': 'en', 'GB': 'en', 'CA': 'en', 'AU': 'en', 'NZ': 'en', 'IE': 'en',
            'IN': 'en', 'PH': 'en', 'SG': 'en', 'ZA': 'en',

            // German speaking countries
            'DE': 'de', 'AT': 'de', 'CH': 'de', 'LI': 'de', 'LU': 'de',

            // Spanish speaking countries
            'ES': 'es', 'MX': 'es', 'AR': 'es', 'CO': 'es', 'PE': 'es', 'VE': 'es',
            'CL': 'es', 'EC': 'es', 'GT': 'es', 'CU': 'es', 'BO': 'es', 'DO': 'es',
            'HN': 'es', 'PY': 'es', 'SV': 'es', 'NI': 'es', 'CR': 'es', 'PA': 'es',
            'UY': 'es', 'GQ': 'es'
        };

        // Get language based on country code
        function getLanguageFromCountry(countryCode) {
            return countryToLang[countryCode] || 'cs'; // Default to Czech if country not in mapping
        }

        // Detekce iOS za≈ô√≠zen√≠
        function detectIOS() {
            const userAgent = navigator.userAgent.toLowerCase();
            isIOS = /iphone|ipad|ipod/.test(userAgent) && !window.MSStream;
            return isIOS;
        }

        // Zobrazit/skr√Ωt Health setup instrukce
        function toggleHealthSetup() {
            showHealthSetup = !showHealthSetup;
            render();
        }

        // Oznaƒçit zkratku jako nainstalovanou a zkusit znovu
        function markShortcutInstalled() {
            localStorage.setItem('hasUsedHealthShortcut', 'true');
            showHealthSetup = false;
            if (lastBpmForHealth) {
                saveToAppleHealth(lastBpmForHealth);
            }
        }

        // Ulo≈æit BPM do Apple Health p≈ôes Shortcuts
        function saveToAppleHealth(bpmValue) {
            if (!isIOS) return;

            lastBpmForHealth = bpmValue;
            const shortcutURL = `shortcuts://run-shortcut?name=SaveHeartRate&input=${encodeURIComponent(bpmValue)}`;

            // Pokud u≈æivatel u≈æ zkratku pou≈æil √∫spƒõ≈°nƒõ, nebo ji manu√°lnƒõ oznaƒçil jako nainstalovanou
            const hasUsedShortcut = localStorage.getItem('hasUsedHealthShortcut');

            if (hasUsedShortcut) {
                window.location.href = shortcutURL;
                return;
            }

            // Prvn√≠ pou≈æit√≠ - detekuj jestli zkratka existuje
            const setupAlreadyShown = sessionStorage.getItem('healthSetupShown');

            // Pokud u≈æ byl setup v t√©to session zobrazen, jen zkus spustit zkratku bez dal≈°√≠ho zobrazov√°n√≠
            if (setupAlreadyShown) {
                window.location.href = shortcutURL;
                return;
            }

            let redirectHappened = false;

            // Kdy≈æ str√°nka ztrat√≠ focus (p≈ôepnut√≠ do Shortcuts), znamen√° to ≈æe zkratka funguje
            const visibilityHandler = () => {
                if (document.hidden) {
                    redirectHappened = true;
                    localStorage.setItem('hasUsedHealthShortcut', 'true');
                    document.removeEventListener('visibilitychange', visibilityHandler);
                }
            };

            document.addEventListener('visibilitychange', visibilityHandler);

            window.location.href = shortcutURL;

            // Pokud se za 500ms nic nestane (str√°nka st√°le viditeln√°), zkratka asi nen√≠ nainstalovan√°
            setTimeout(() => {
                document.removeEventListener('visibilitychange', visibilityHandler);
                if (!redirectHappened && !document.hidden) {
                    // Zkratka neexistuje - zobraz setup (jen jednou za session)
                    showHealthSetup = true;
                    sessionStorage.setItem('healthSetupShown', 'true');
                    render();
                }
            }, 500);
        }

        // Detekce zemƒõ u≈æivatele
        async function detectUserCountry() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                userCountry = data.country_code || 'unknown';
                console.log('Country detected:', userCountry);

                // Set language based on country if not manually overridden
                const manualLangOverride = localStorage.getItem('manualLangOverride');
                if (!manualLangOverride && userCountry !== 'unknown') {
                    const detectedLang = getLanguageFromCountry(userCountry);
                    currentLang = detectedLang;
                    console.log('Language set to:', detectedLang, 'based on country:', userCountry);
                    render();
                }
            } catch (error) {
                console.error('Failed to detect country:', error);
                userCountry = 'unknown';
            }
        }

        // Naƒç√≠st mƒõ≈ôen√≠ z aktu√°ln√≠ session
        function loadSessionMeasurements() {
            const stored = localStorage.getItem('sessionMeasurements');
            const lastSessionTime = localStorage.getItem('lastSessionTimestamp');
            const now = Date.now();
            const SESSION_DURATION = 30 * 60 * 1000;

            // Reset pokud je to nov√° session
            if (!lastSessionTime || (now - parseInt(lastSessionTime)) > SESSION_DURATION) {
                sessionMeasurements = [];
                localStorage.setItem('sessionMeasurements', JSON.stringify([]));
            } else if (stored) {
                sessionMeasurements = JSON.parse(stored);
            }
        }

        // Firebase session-based poƒç√≠tadlo n√°v≈°tƒõv
        async function initFirebaseCounters() {
            try {
                const now = Date.now();
                const lastSessionTime = localStorage.getItem('lastSessionTimestamp');
                const SESSION_DURATION = 30 * 60 * 1000; // 30 minut

                // Zkontroluj, jestli je to nov√° session
                const isNewSession = !lastSessionTime || (now - parseInt(lastSessionTime)) > SESSION_DURATION;

                const visitsRef = window.firebaseRef(window.firebaseDB, 'counters/visits');

                // Increment jen p≈ôi nov√© session
                if (isNewSession) {
                    await window.firebaseTransaction(visitsRef, (current) => {
                        return (current || 0) + 1;
                    });
                    // Ulo≈æ timestamp t√©to session
                    localStorage.setItem('lastSessionTimestamp', now.toString());
                }

                // Listen for real-time updates
                window.firebaseOnValue(visitsRef, (snapshot) => {
                    visitCount = snapshot.val() || 0;
                    render();
                });

                // Listen for measurements counter
                const measurementsRef = window.firebaseRef(window.firebaseDB, 'counters/measurements');
                window.firebaseOnValue(measurementsRef, (snapshot) => {
                    measurementCount = snapshot.val() || 0;
                    render();
                });
            } catch (error) {
                console.error('Firebase error:', error);
                // Fallback to localStorage
                visitCount = parseInt(localStorage.getItem('sessionCount') || '0');
                if (!localStorage.getItem('lastSessionTimestamp')) {
                    visitCount++;
                    localStorage.setItem('sessionCount', visitCount);
                    localStorage.setItem('lastSessionTimestamp', Date.now().toString());
                }
            }
        }

        // Ulo≈æit mƒõ≈ôen√≠ do Firebase
        async function saveMeasurement(bpmValue) {
            try {
                // Kontrola session limitu
                if (sessionMeasurements.length >= MAX_MEASUREMENTS_PER_SESSION) {
                    console.warn('Session measurement limit reached');
                    return false;
                }

                // Kontrola celkov√©ho limitu
                if (measurementCount >= MAX_TOTAL_MEASUREMENTS) {
                    console.warn('Total measurement limit reached (1 GB)');
                    return false;
                }

                const timestamp = Date.now();
                const oneYearAgo = timestamp - (365 * 24 * 60 * 60 * 1000);

                // Pokud je timestamp star≈°√≠ ne≈æ rok, neukladat (retence 1 rok)
                if (timestamp < oneYearAgo) {
                    return false;
                }

                // Ulo≈æit detail mƒõ≈ôen√≠
                const measurementRef = window.firebaseRef(window.firebaseDB, `measurements/${timestamp}`);
                await window.firebaseTransaction(measurementRef, () => {
                    return {
                        bpm: bpmValue,
                        country: userCountry,
                        timestamp: timestamp
                    };
                });

                // Increment celkov√Ω counter mƒõ≈ôen√≠
                const measurementsRef = window.firebaseRef(window.firebaseDB, 'counters/measurements');
                await window.firebaseTransaction(measurementsRef, (current) => {
                    return (current || 0) + 1;
                });

                // Increment counter per country
                const countryMeasurementsRef = window.firebaseRef(window.firebaseDB, `counters/measurementsByCountry/${userCountry}`);
                await window.firebaseTransaction(countryMeasurementsRef, (current) => {
                    return (current || 0) + 1;
                });

                // P≈ôidat BPM k celkov√© sumƒõ per country
                const countryBpmRef = window.firebaseRef(window.firebaseDB, `counters/totalBpmByCountry/${userCountry}`);
                await window.firebaseTransaction(countryBpmRef, (current) => {
                    return (current || 0) + bpmValue;
                });

                // P≈ôidat do session measurements
                sessionMeasurements.push(timestamp);
                localStorage.setItem('sessionMeasurements', JSON.stringify(sessionMeasurements));

                return true;
            } catch (error) {
                console.error('Failed to save measurement:', error);
                return false;
            }
        }

        const translations = {
            cs: {
                title: 'Mƒõ≈ôen√≠ tepov√© frekvence',
                subtitle: 'Klikejte v rytmu sv√©ho tepu',
                bpmUnit: 'tep≈Ø za minutu',
                category: {
                    resting: 'Klidov√Ω',
                    normal: 'Norm√°ln√≠',
                    elevated: 'Zv√Ω≈°en√Ω',
                    high: 'Vysok√Ω'
                },
                clickCount: 'Poƒçet kliknut√≠:',
                hint: 'Pro p≈ôesnƒõj≈°√≠ mƒõ≈ôen√≠ klikejte alespo≈à 5-10x',
                startMessage: 'Zaƒçnƒõte klikat...',
                clicksMessage: 'kliknut√≠...',
                reset: 'Resetovat',
                howToTitle: 'Jak mƒõ≈ôit:',
                howTo: [
                    'Najdƒõte si tep na krku nebo z√°pƒõst√≠',
                    'Klikejte na ka≈æd√Ω √∫der srdce',
                    'Pokraƒçujte alespo≈à 5-10 √∫der≈Ø',
                    'Aplikace vypoƒç√≠t√° v√°≈° puls'
                ],
                sessionCount: 'N√°v≈°tƒõv:',
                measurementCount: 'Mƒõ≈ôen√≠:',
                privacyStatement: 'Ukl√°d√°me: BPM, zemi, ƒças mƒõ≈ôen√≠ ‚Ä¢ Neukl√°d√°me: IP adresy, jm√©na, osobn√≠ √∫daje',
                saveToHealth: 'Ulo≈æit do Health',
                healthSetup: {
                    title: 'Nastaven√≠ Apple Health',
                    description: 'Pro ulo≈æen√≠ tepov√© frekvence do Health je pot≈ôeba jednor√°zovƒõ nainstalovat zkratku.',
                    downloadButton: 'St√°hnout zkratku',
                    orManual: 'Nebo vytvo≈ôit manu√°lnƒõ',
                    installed: 'M√°m nainstalov√°no, spustit',
                    close: 'Zav≈ô√≠t',
                    setupLink: 'Jak nastavit?'
                },
                shareTitle: 'Sd√≠let',
                shareText: 'Zmƒõ≈ôte si tepovou frekvenci online zdarma!',
                linkCopied: 'Link zkop√≠rov√°n!'
            },
            en: {
                title: 'Heart Rate Measurement',
                subtitle: 'Tap in rhythm with your heartbeat',
                bpmUnit: 'beats per minute',
                category: {
                    resting: 'Resting',
                    normal: 'Normal',
                    elevated: 'Elevated',
                    high: 'High'
                },
                clickCount: 'Tap count:',
                hint: 'For more accurate results, tap at least 5-10 times',
                startMessage: 'Start tapping...',
                clicksMessage: 'taps...',
                reset: 'Reset',
                howToTitle: 'How to measure:',
                howTo: [
                    'Find your pulse on neck or wrist',
                    'Tap on each heartbeat',
                    'Continue for at least 5-10 beats',
                    'App will calculate your heart rate'
                ],
                sessionCount: 'Visits:',
                measurementCount: 'Measurements:',
                privacyStatement: 'We store: BPM, country, timestamp ‚Ä¢ We don\'t store: IP addresses, names, personal data',
                saveToHealth: 'Save to Health',
                healthSetup: {
                    title: 'Apple Health Setup',
                    description: 'To save heart rate to Health, you need to install the shortcut once.',
                    downloadButton: 'Download Shortcut',
                    orManual: 'Or create manually',
                    installed: 'Already installed, try now',
                    close: 'Close',
                    setupLink: 'How to set up?'
                },
                shareTitle: 'Share',
                shareText: 'Measure your heart rate online for free!',
                linkCopied: 'Link copied!'
            },
            de: {
                title: 'Herzfrequenzmessung',
                subtitle: 'Tippen Sie im Rhythmus Ihres Herzschlags',
                bpmUnit: 'Schl√§ge pro Minute',
                category: {
                    resting: 'Ruhepuls',
                    normal: 'Normal',
                    elevated: 'Erh√∂ht',
                    high: 'Hoch'
                },
                clickCount: 'Anzahl der Klicks:',
                hint: 'F√ºr genauere Ergebnisse mindestens 5-10 Mal tippen',
                startMessage: 'Beginnen Sie zu tippen...',
                clicksMessage: 'Klicks...',
                reset: 'Zur√ºcksetzen',
                howToTitle: 'So messen Sie:',
                howTo: [
                    'Finden Sie Ihren Puls am Hals oder Handgelenk',
                    'Tippen Sie bei jedem Herzschlag',
                    'Fahren Sie mindestens 5-10 Schl√§ge fort',
                    'Die App berechnet Ihre Herzfrequenz'
                ],
                sessionCount: 'Besuche:',
                measurementCount: 'Messungen:',
                privacyStatement: 'Wir speichern: BPM, Land, Zeitstempel ‚Ä¢ Wir speichern nicht: IP-Adressen, Namen, pers√∂nliche Daten',
                saveToHealth: 'In Health speichern',
                healthSetup: {
                    title: 'Apple Health Einrichtung',
                    description: 'Um die Herzfrequenz in Health zu speichern, m√ºssen Sie einmalig die Verkn√ºpfung installieren.',
                    downloadButton: 'Verkn√ºpfung laden',
                    orManual: 'Oder manuell erstellen',
                    installed: 'Bereits installiert, jetzt versuchen',
                    close: 'Schlie√üen',
                    setupLink: 'Wie einrichten?'
                },
                shareTitle: 'Teilen',
                shareText: 'Messen Sie Ihre Herzfrequenz kostenlos online!',
                linkCopied: 'Link kopiert!'
            },
            es: {
                title: 'Medici√≥n de frecuencia card√≠aca',
                subtitle: 'Toca al ritmo de tu coraz√≥n',
                bpmUnit: 'latidos por minuto',
                category: {
                    resting: 'En reposo',
                    normal: 'Normal',
                    elevated: 'Elevado',
                    high: 'Alto'
                },
                clickCount: 'N√∫mero de toques:',
                hint: 'Para resultados m√°s precisos, toca al menos 5-10 veces',
                startMessage: 'Comienza a tocar...',
                clicksMessage: 'toques...',
                reset: 'Reiniciar',
                howToTitle: 'C√≥mo medir:',
                howTo: [
                    'Encuentra tu pulso en el cuello o mu√±eca',
                    'Toca en cada latido del coraz√≥n',
                    'Contin√∫a durante al menos 5-10 latidos',
                    'La app calcular√° tu frecuencia card√≠aca'
                ],
                sessionCount: 'Visitas:',
                measurementCount: 'Mediciones:',
                privacyStatement: 'Almacenamos: BPM, pa√≠s, marca de tiempo ‚Ä¢ No almacenamos: direcciones IP, nombres, datos personales',
                saveToHealth: 'Guardar en Salud',
                healthSetup: {
                    title: 'Configuraci√≥n de Apple Health',
                    description: 'Para guardar la frecuencia card√≠aca en Health, necesita instalar el atajo una vez.',
                    downloadButton: 'Descargar Atajo',
                    orManual: 'O crear manualmente',
                    installed: 'Ya instalado, probar ahora',
                    close: 'Cerrar',
                    setupLink: '¬øC√≥mo configurar?'
                },
                shareTitle: 'Compartir',
                shareText: '¬°Mide tu frecuencia card√≠aca online gratis!',
                linkCopied: '¬°Enlace copiado!'
            }
        };

        function handleClick() {
            const now = Date.now();
            clicks.push(now);
            isActive = true;
            calculateBPM();
            render();
        }

        function calculateBPM() {
            if (clicks.length < 2) return;

            const recentClicks = clicks.slice(-10);
            
            if (recentClicks.length >= 2) {
                const intervals = [];
                for (let i = 1; i < recentClicks.length; i++) {
                    intervals.push(recentClicks[i] - recentClicks[i - 1]);
                }
                
                const avgInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length;
                const calculatedBpm = Math.round(60000 / avgInterval);
                
                if (calculatedBpm >= 30 && calculatedBpm <= 220) {
                    bpm = calculatedBpm;
                }
            }
        }

        function reset() {
            // Ulo≈æit mƒõ≈ôen√≠ pokud je validn√≠
            if (bpm !== null && clicks.length >= 5) {
                saveMeasurement(bpm);
            }
            clicks = [];
            bpm = null;
            isActive = false;
            render();
        }

        function changeLang(lang) {
            currentLang = lang;
            // Save manual language override
            localStorage.setItem('manualLangOverride', lang);
            console.log('Language manually changed to:', lang);
            render();
        }

        // Sd√≠len√≠ na soci√°ln√≠ s√≠tƒõ
        function shareOn(platform) {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent(translations[currentLang].shareText);

            const shareUrls = {
                twitter: `https://twitter.com/intent/tweet?text=${text}&url=${url}`,
                facebook: `https://www.facebook.com/sharer/sharer.php?u=${url}`,
                linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${url}`,
                whatsapp: `https://wa.me/?text=${text}%20${url}`,
                email: `mailto:?subject=${text}&body=${text}%20${url}`
            };

            if (shareUrls[platform]) {
                window.open(shareUrls[platform], '_blank', 'width=600,height=400');
            }
        }

        // Kop√≠rovat URL
        function copyLink() {
            const t = translations[currentLang];
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('‚úì ' + t.linkCopied);
            });
        }

        function getBpmCategory(bpm) {
            if (!bpm) return { text: '', color: '' };
            const t = translations[currentLang].category;
            if (bpm < 60) return { text: t.resting, color: 'text-blue-600' };
            if (bpm < 100) return { text: t.normal, color: 'text-green-600' };
            if (bpm < 140) return { text: t.elevated, color: 'text-orange-600' };
            return { text: t.high, color: 'text-red-600' };
        }

        function render() {
            const t = translations[currentLang];
            const category = getBpmCategory(bpm);
            
            document.getElementById('app').innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-red-50 to-pink-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
                        
                        <!-- Language Selector -->
                        <div class="flex justify-center gap-2 mb-6">
                            ${['cs', 'en', 'de', 'es'].map(lang => `
                                <button
                                    onclick="changeLang('${lang}')"
                                    class="px-3 py-1 rounded-lg text-sm font-medium transition-colors ${
                                        currentLang === lang 
                                            ? 'bg-red-500 text-white' 
                                            : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                    }"
                                >
                                    ${lang.toUpperCase()}
                                </button>
                            `).join('')}
                        </div>

                        <div class="text-center mb-8">
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">
                                ${t.title}
                            </h1>
                            <p class="text-gray-600">
                                ${t.subtitle}
                            </p>
                        </div>

                        <button
                            onclick="handleClick()"
                            class="w-full aspect-square rounded-full bg-gradient-to-br from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 active:scale-95 transition-all duration-200 shadow-lg flex items-center justify-center mb-8 cursor-pointer"
                        >
                            <svg class="w-24 h-24 text-white ${isActive ? 'heartbeat' : ''}" fill="white" stroke="white" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                            </svg>
                        </button>

                        <div class="text-center mb-6">
                            ${bpm ? `
                                <div class="text-6xl font-bold text-gray-800 mb-2">
                                    ${bpm}
                                </div>
                                <div class="text-xl text-gray-600 mb-1">
                                    ${t.bpmUnit}
                                </div>
                                <div class="text-lg font-semibold ${category.color}">
                                    ${category.text}
                                </div>
                            ` : `
                                <div class="text-gray-400 text-lg py-8">
                                    ${clicks.length === 0 ? t.startMessage : `${clicks.length} ${t.clicksMessage}`}
                                </div>
                            `}
                        </div>

                        <div class="bg-gray-50 rounded-xl p-4 mb-6">
                            <div class="text-sm text-gray-600 space-y-1">
                                <div class="flex justify-between">
                                    <span>${t.clickCount}</span>
                                    <span class="font-semibold">${clicks.length}</span>
                                </div>
                                ${clicks.length >= 2 ? `
                                    <div class="text-xs text-gray-500 mt-2">
                                        ${t.hint}
                                    </div>
                                ` : ''}
                            </div>
                        </div>

                        ${isIOS && bpm !== null ? `
                        <button
                            onclick="saveToAppleHealth(${bpm})"
                            class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center gap-2 cursor-pointer mb-2"
                        >
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                            </svg>
                            ${t.saveToHealth}
                        </button>
                        <div class="text-center mb-3">
                            <button onclick="toggleHealthSetup()" class="text-xs text-gray-500 hover:text-gray-700 underline">
                                ‚ÑπÔ∏è ${t.healthSetup.setupLink}
                            </button>
                        </div>
                        ` : ''}

                        <button
                            onclick="reset()"
                            class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center gap-2 cursor-pointer"
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                            ${t.reset}
                        </button>

                        <div class="mt-6 p-4 bg-blue-50 rounded-xl">
                            <h3 class="font-semibold text-blue-900 mb-2 text-sm">
                                ${t.howToTitle}
                            </h3>
                            <ol class="text-xs text-blue-800 space-y-1 list-decimal list-inside">
                                ${t.howTo.map(item => `<li>${item}</li>`).join('')}
                            </ol>
                        </div>

                        <!-- Sd√≠len√≠ -->
                        <div class="mt-6 p-4 bg-gray-50 rounded-xl">
                            <h3 class="font-semibold text-gray-700 mb-3 text-sm text-center">
                                ${t.shareTitle}
                            </h3>
                            <div class="flex flex-wrap gap-2 justify-center">
                                <button onclick="shareOn('twitter')"
                                        class="flex items-center gap-1 px-3 py-2 bg-blue-400 hover:bg-blue-500 text-white rounded-lg text-xs transition-colors">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/>
                                    </svg>
                                    Twitter
                                </button>
                                <button onclick="shareOn('facebook')"
                                        class="flex items-center gap-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-xs transition-colors">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                                    </svg>
                                    Facebook
                                </button>
                                <button onclick="shareOn('linkedin')"
                                        class="flex items-center gap-1 px-3 py-2 bg-blue-700 hover:bg-blue-800 text-white rounded-lg text-xs transition-colors">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                                    </svg>
                                    LinkedIn
                                </button>
                                <button onclick="shareOn('whatsapp')"
                                        class="flex items-center gap-1 px-3 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-xs transition-colors">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                                    </svg>
                                    WhatsApp
                                </button>
                                <button onclick="shareOn('email')"
                                        class="flex items-center gap-1 px-3 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg text-xs transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                    </svg>
                                    Email
                                </button>
                                <button onclick="copyLink()"
                                        class="flex items-center gap-1 px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-xs transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                    </svg>
                                    Copy
                                </button>
                            </div>
                        </div>

                        <!-- Glob√°ln√≠ statistiky -->
                        <div class="mt-6 p-2 text-center text-xs text-gray-400">
                            ${t.sessionCount} ${visitCount.toLocaleString()} ‚Ä¢ ${t.measurementCount} ${measurementCount.toLocaleString()}
                        </div>

                        <!-- Privacy -->
                        <div class="mt-2 p-2 text-center text-xs text-gray-300 italic">
                            üîí ${t.privacyStatement}
                        </div>
                    </div>
                </div>

                ${showHealthSetup && isIOS ? `
                <!-- Health Setup Modal -->
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onclick="toggleHealthSetup()">
                    <div class="bg-white rounded-2xl p-6 max-w-md w-full" onclick="event.stopPropagation()">
                        <h2 class="text-xl font-bold text-gray-800 mb-3">
                            ${t.healthSetup.title}
                        </h2>
                        <p class="text-sm text-gray-600 mb-4">
                            ${t.healthSetup.description}
                        </p>

                        <a href="${SHORTCUT_ICLOUD_LINK}"
                           class="block w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 text-center mb-3">
                            üì• ${t.healthSetup.downloadButton}
                        </a>

                        <a href="IOS_HEALTH_SETUP.md" target="_blank"
                           class="block text-center text-sm text-gray-500 hover:text-gray-700 underline mb-4">
                            ${t.healthSetup.orManual}
                        </a>

                        <button onclick="markShortcutInstalled()"
                                class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 mb-3">
                            ‚úì ${t.healthSetup.installed}
                        </button>

                        <button onclick="toggleHealthSetup()"
                                class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-xl">
                            ${t.healthSetup.close}
                        </button>
                    </div>
                </div>
                ` : ''}
            `;
        }

        // Initialize app
        detectIOS();

        // Check for manual language override
        const manualLangOverride = localStorage.getItem('manualLangOverride');
        if (manualLangOverride) {
            currentLang = manualLangOverride;
            console.log('Using manual language override:', manualLangOverride);
        }

        render();
        loadSessionMeasurements();
        detectUserCountry();

        // Wait for Firebase to be ready, then initialize counters
        setTimeout(() => {
            if (window.firebaseDB) {
                initFirebaseCounters();
            }
        }, 100);
    </script>
</body>
</html>
